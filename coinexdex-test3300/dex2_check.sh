#!/usr/bin/env bash

declare -A nodeNameByAddr=(
  ["2D0EF6768B05EE7E055D91D1EADCF059F4470CC2"]="CETDAC"
  ["8ACCB6066DCE5AA189245BF9E24C6026DD5C0EED"]="Singa"
  ["314BA1C0C3695FE326A7409C348270E6842A998E"]="IFWallet"
  ["04A7E3AC41C71CB5020FAEC3205DD1822910E31C"]="JiuYin"
  ["EEE9E89D623F8C2871F05FEFA0A422474327CF20"]="ViaWallet"
  ["DDF95ECF20234FE9842DA70A55300F41D741677A"]="FX "
  ["0FAF7D7C84A20ACA8E84C8579502DEC40076BA54"]="CETDEX"
  ["F0DDD65C52784394EFAD8E35BCFC5A7D8A62B1CD"]="Seele.pro 元一公链"
  ["CCF1E18BF111CF12FA27D75FFDC55660A20A4F5C"]="Jiucai.one "
  ["95D448AECBFD1093C1C11BC619BE1AE7D2FE545E"]="大胡建"
  ["B37F808340EF966629B862B781B81EB7C40CE4FE"]="Matrixport"
  ["AD562B1D685D2DFE44608EA2E30A7937A5A30642"]="chainfor链向"
  ["81C3952BC95264FCD1002168B15BB3368003BFD1"]="BTC.com"
  ["9C30AA6E65A617998F9E8FEE5F22D4A5BF365D65"]="BTC.TOP"
  ["D107EC14001C3C5A6044771E6DEC7B98BDAA4094"]="Dream_of_the_Stars"
  ["4F42468DB66D6118B0DC02FFB4CC97FB0D156035"]="ToNode图节点"
  ["6FD46F5E8125DA34FD0F91568925E4876309D877"]="Hoo.com"
  ["201730AEBF047C7EF40844BF22FD93FE94FB8F02"]="HLT"
  ["42EAE3B96D45F21FF8779EC2F24673CB04050881"]="eosforce"
  ["04433E5E7D7C124E66E1F4189791D8BDF28EA546"]="Nodeasy.com 节点易"
  ["29FBF9C4D62AD4E647F407D1BA92ED3D9D35A476"]="InfStones"
  ["EE7FE995EC807F9CB01E7AAF8DB4E77FAC4F94D2"]="coinbase "
  ["3A12FF247AB49855690F64836F73DFC539B9547B"]="BitFlower 野花说"
  ["0A3068AA918E559FE12238F00A0BA81B9535C57C"]="HonestNode "
  ["5E18F4B01D477DB1EA26A8A546CD3739E3FF2AF1"]="MathWallet "
  ["DAE097311ADA210AE8826B874A1FFBDF4C8E1CDA"]="ABCWallet"
  ["27E0DABE150285F60DA29F7D3805A3B49B9E48D6"]="HashQuark"
  ["5B12B0F1CC5C415BD7B1F40239EB849485224680"]="coinbull "
  ["71A804D7F06FA0E5DABB52F179FA510DC1C301E9"]="RealmX "
  ["FEC522E55E24DD331A542819C981443C842CA301"]="bitcoincom"
  ["C6F2D25A8964EE38AF0158DDF59C450A8340FF3E"]="wayi.cn"
  ["C11DDF70B5882CA66352A525B90BEB07D9B082DA"]="Liebi"
  ["27F73F07B2FD63070587888E6564BBFEEDE73C6E"]="consensus-lab"
  ["6404AF9ABA24FAE5A38A5BB9CACCB5EBFD1431D3"]="AntPool"
  ["DAE6F664ED7C9905CBE820B16C4C4D26C9245E84"]="1TMine"
  ["F832464AD23F1793B6EF4EA34B57CA3012E74CE6"]="ti"
  ["BCCDC32DE1226A29B4DC9088348D8FDC10321FA8"]="GlobalIPs"
  ["1631FAED5C470DE7335CC54E146EB33192C13997"]="neutstech"
  ["75FEECB326F5984408C9C2A2689230B3447C05E2"]="To the moon"
  ["DE5BD4EF084344D363FA1381AC98B403C1B30BAF"]="Blockchain007"
  ["6B015274173BAC8234CB20F74EDE3F250CAF044F"]="IFW test"
)

echo "BASE_URL   : ${ARTIFACTS_BASE_URL}"
echo "CETD_URL   : ${CETD_URL}"
echo "CETCLI_URL : ${CETD_URL}"
echo "GENESIS_URL: ${GENESIS_URL}"
echo "RUN_DIR    : ${RUN_DIR}"

SUM_CETD=$(wget "${CETD_URL}.sum" -q -O -)
SUM_CETCLI=$(wget "${CETCLI_URL}.sum" -q -O -)
SUM_GENESIS=$(wget "${GENESIS_URL}.sum" -q -O -)

LOCAL_SUM_CETD=$(sha256sum cetd | awk '{ print $1 }')
LOCAL_SUM_CETCLI=$(sha256sum cetcli | awk '{ print $1 }')
LOCAL_SUM_GENESIS=$(sha256sum "${RUN_DIR}/.cetd/config/genesis.json" | awk '{ print $1 }')
LOCAL_SUM_KEY=$(sha256sum "${RUN_DIR}/.cetd/config/priv_validator_key.json" | awk '{ print $1 }')

if [ "$SUM_CETD" = "$LOCAL_SUM_CETD" ]; then
    echo "sha256(cetd)         : ${LOCAL_SUM_CETD}, OK"
else
    echo "CETD checksum mismatch!"
    exit 1
fi
if [ "$SUM_CETCLI" = "$LOCAL_SUM_CETCLI" ]; then
    echo "sha256(cetcli)       : ${LOCAL_SUM_CETCLI}, OK"
else
    echo "CETCLI checksum mismatch!"
    exit 1
fi
if [ "$SUM_GENESIS" = "$LOCAL_SUM_GENESIS" ]; then
    echo "sha256(genesis.json) : ${LOCAL_SUM_GENESIS}, OK"
else
    echo "GENESIS checksum mismatch!"
    exit 1
fi
echo "sha256(priv_key.json): ${LOCAL_SUM_KEY}"

ADDR=$(cat .cetd/config/priv_validator_key.json | grep address | grep -o ": .*" | grep -o '[0-9a-zA-Z]\{40\}')
echo "Node Name: ${nodeNameByAddr[$ADDR]}"

cat .cetd/config/config.toml | grep log_level
